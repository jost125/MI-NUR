<div class="navbar projectMenu">
	<div class="navbar-inner">
		<div class="container">
			<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>
			<div class="nav-collapse collapse">
				<ul class="nav">
					<li><a href="">Done</a></li>
					<li><a href="" class="active">Current</a></li>
					<li><a href="" class="active">Backlog</a></li>
					<li><a href="" class="active">Icebox</a></li>
					<li><a href="">Deadlines</a></li>
					<li><a href="">MyWork</a></li>
				</ul>
			</div><!--/.nav-collapse -->
			<form class="navbar-form pull-right">
				<button type="submit" class="btn">+ Add task</button>
				<input type="text" class="span2" placeholder="Search">
			</form>
		</div>
	</div>
</div>
<div class="container-fluid">
	<div class="row-fluid taskBoxes">
		<div class="span4 taskBox">
			<div class="boxHeader">Current</div>
			<ul ng-model="currentTasks" class="tasks currentTasks">
				<li ng-repeat="(index, task) in currentTasks" class="item" data-index="{{ index }}">
					{{ task.name }}
				</li>
			</ul>
		</div>
		<div class="span4 taskBox">
			<div class="boxHeader">Backlog</div>
			<ul ng-model="backlogTasks" class="tasks backlogTasks">
				<li ng-repeat="task in backlogTasks" class="item">
					{{ task.name }}
				</li>
			</ul>
		</div>
		<div class="span4 taskBox">
			<div class="boxHeader">Icebox</div>
			<ul ng-model="iceboxTasks" class="tasks iceboxTasks">
				<li ng-repeat="task in iceboxTasks" class="item">
					{{ task.name }}
				</li>
			</ul>
		</div>
	</div>
</div>

<script>
	$(function() {

		var reindexModel = function() {
			var taskListElement = angular.element(this);
			var taskElement = taskListElement.find('li');

			var indexes = [];
			taskElement.each(function() {
				indexes.push($(this).attr('data-index'));
			});

			var $scope = taskListElement.scope();

			var reordered = [];
			for (i in indexes) {
				reordered.push($scope.currentTasks[indexes[i]]);
			}

			$scope.$apply(function() {
				$scope.currentTasks = reordered;
			});

		}

		$('.tasks').sortable({
			'update': reindexModel
		});
	})
</script>